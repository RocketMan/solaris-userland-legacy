Patch taken from: https://gitlab.com/libtiff/libtiff/commit/3719385a3fac5cfb20b487619a5f08abbf967cf8
		  https://gitlab.com/libtiff/libtiff/commit/7a092f8af2568d61993a8cc2e7a35a998d7d37be

--- a/libtiff/tif_dirread.c.orig	2017-09-16 12:07:56.391614321 -0700
+++ b/libtiff/tif_dirread.c	2018-10-23 02:20:35.565283920 -0700
@@ -5698,6 +5698,16 @@
         if( nstrips == 0 )
             return;
 
+        /* If we are going to allocate a lot of memory, make sure that the */
+	        /* file is as big as needed */
+	        if( tif->tif_mode == O_RDONLY &&
+	            nstrips > 1000000 &&
+            	(offset >= TIFFGetFileSize(tif) ||
+	         stripbytes > (TIFFGetFileSize(tif) - offset) / (nstrips - 1)) )
+	        {
+	            return;
+	        }
+
 	newcounts = (uint64*) _TIFFCheckMalloc(tif, nstrips, sizeof (uint64),
 				"for chopped \"StripByteCounts\" array");
 	newoffsets = (uint64*) _TIFFCheckMalloc(tif, nstrips, sizeof (uint64),
